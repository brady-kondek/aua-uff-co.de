<p>Der Computer bestehend aus CPU, RAM (Memory) und ROM (ROM32K):</p>

<div class="language-vhdl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CHIP</span> <span class="n">Computer</span> <span class="err">{</span>
    <span class="k">IN</span> <span class="n">reset</span><span class="p">;</span>

    <span class="n">PARTS</span><span class="p">:</span>
    <span class="n">CPU</span> <span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="n">reset</span><span class="p">,</span> <span class="n">instruction</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">inM</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">addressM</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">writeM</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">outM</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="n">n</span><span class="p">);</span>
    <span class="n">Memory</span><span class="p">(</span><span class="k">in</span><span class="o">=</span><span class="n">m</span> <span class="p">,</span><span class="n">load</span><span class="o">=</span><span class="n">l</span> <span class="p">,</span><span class="n">address</span><span class="o">=</span><span class="n">k</span> <span class="p">,</span><span class="k">out</span><span class="o">=</span><span class="n">j</span><span class="p">);</span>
    <span class="n">ROM32K</span> <span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">i</span><span class="p">);</span>
<span class="err">}</span>
</code></pre></div></div>

<p>Die CPU mit ihren Hauptbestandteilen Controll Unit, A und D Register, Rechenwerk (ALU) und Program
Counter (PC):</p>

<p><img src="/img/cpu.png" alt="CPU Schemadiagramm" /></p>

<div class="language-vhdl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CHIP</span> <span class="n">CPU</span> <span class="err">{</span>
    <span class="k">IN</span>  <span class="n">inM</span><span class="err">[</span><span class="mi">16</span><span class="err">]</span><span class="p">,</span>         <span class="o">//</span> <span class="n">M</span> <span class="n">value</span> <span class="n">input</span>  <span class="p">(</span><span class="n">M</span> <span class="o">=</span> <span class="n">contents</span> <span class="k">of</span> <span class="n">RAM</span><span class="err">[</span><span class="n">A</span><span class="err">]</span><span class="p">)</span>
        <span class="n">instruction</span><span class="err">[</span><span class="mi">16</span><span class="err">]</span><span class="p">,</span> <span class="o">//</span> <span class="n">Instruction</span> <span class="k">for</span> <span class="n">execution</span>
        <span class="n">reset</span><span class="p">;</span>           <span class="o">//</span> <span class="n">Signals</span> <span class="n">whether</span> <span class="k">to</span> <span class="n">re</span><span class="o">-</span><span class="n">start</span> <span class="n">the</span> <span class="n">current</span>
                         <span class="o">//</span> <span class="n">program</span> <span class="p">(</span><span class="n">reset</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">continue</span> <span class="n">executing</span>
                         <span class="o">//</span> <span class="n">the</span> <span class="n">current</span> <span class="n">program</span> <span class="p">(</span><span class="n">reset</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span>

    <span class="k">OUT</span> <span class="n">outM</span><span class="err">[</span><span class="mi">16</span><span class="err">]</span><span class="p">,</span>        <span class="o">//</span> <span class="n">M</span> <span class="n">value</span> <span class="n">output</span>
        <span class="n">writeM</span><span class="p">,</span>          <span class="o">//</span> <span class="n">Write</span> <span class="k">to</span> <span class="n">M</span><span class="o">?</span>
        <span class="n">addressM</span><span class="err">[</span><span class="mi">15</span><span class="err">]</span><span class="p">,</span>    <span class="o">//</span> <span class="n">Address</span> <span class="k">in</span> <span class="n">data</span> <span class="n">memory</span> <span class="p">(</span><span class="k">of</span> <span class="n">M</span><span class="p">)</span>
        <span class="n">pc</span><span class="err">[</span><span class="mi">15</span><span class="err">]</span><span class="p">;</span>          <span class="o">//</span> <span class="n">address</span> <span class="k">of</span> <span class="k">next</span> <span class="n">instruction</span>

    <span class="n">PARTS</span><span class="p">:</span>
    <span class="o">//</span> <span class="n">a</span> <span class="ow">or</span> <span class="n">c</span><span class="o">-</span><span class="k">type</span> <span class="n">instruction</span><span class="o">?</span>
    <span class="ow">Not</span><span class="p">(</span><span class="k">in</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">15</span><span class="err">]</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">aType</span><span class="p">);</span>
    <span class="ow">Or</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">12</span><span class="err">]</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">cType</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">where</span> <span class="k">to</span> <span class="n">store</span>
    <span class="ow">And</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">5</span><span class="err">]</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">15</span><span class="err">]</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">writeA</span><span class="p">);</span>
    <span class="ow">And</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">4</span><span class="err">]</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">15</span><span class="err">]</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">writeD</span><span class="p">);</span>
    <span class="ow">And</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">3</span><span class="err">]</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">15</span><span class="err">]</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">writeM</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">logical</span> <span class="n">conditions</span> <span class="n">needed</span> <span class="k">for</span> <span class="n">the</span> <span class="n">control</span> <span class="n">logic</span>
    <span class="ow">Not</span><span class="p">(</span><span class="k">in</span><span class="o">=</span><span class="n">zr</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">jne</span><span class="p">);</span>
    <span class="ow">Not</span><span class="p">(</span><span class="k">in</span><span class="o">=</span><span class="n">jle</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">jgt</span><span class="p">);</span>
    <span class="ow">Or</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">zr</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">jgt</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">jge</span><span class="p">);</span>
    <span class="ow">Or</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">zr</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">ng</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">jle</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">the</span> <span class="n">actual</span> <span class="n">control</span> <span class="n">logic</span>
    <span class="n">Mux8Way</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">jgt</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">zr</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">jge</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">ng</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">jne</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="n">jle</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="nb">true</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="err">]</span><span class="p">,</span>
            <span class="k">out</span><span class="o">=</span><span class="n">jumpIfaType</span><span class="p">);</span>
    <span class="ow">And</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">15</span><span class="err">]</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">jumpIfaType</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">doJump</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">the</span> <span class="n">mux</span> <span class="k">on</span> <span class="n">the</span> <span class="n">left</span> <span class="k">of</span> <span class="n">diagam</span> <span class="mi">5</span><span class="o">.</span><span class="mi">9</span>
    <span class="n">Mux16</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">ALUout</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">instruction</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">aType</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">Ain</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">A</span> <span class="k">register</span> <span class="p">(</span><span class="n">could</span> <span class="k">use</span> <span class="n">plain</span> <span class="k">register</span><span class="p">,</span> <span class="n">but</span> <span class="n">tests</span> <span class="n">want</span> <span class="n">it</span><span class="p">)</span>
    <span class="ow">Or</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">aType</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">writeA</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">loadA</span><span class="p">);</span>
    <span class="n">ARegister</span><span class="p">(</span><span class="k">in</span><span class="o">=</span><span class="n">Ain</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="n">loadA</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">Aout</span><span class="p">,</span> <span class="k">out</span><span class="err">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">14</span><span class="err">]</span><span class="o">=</span><span class="n">addressM</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">D</span> <span class="k">register</span> <span class="p">(</span><span class="n">could</span> <span class="k">use</span> <span class="n">plain</span> <span class="k">register</span><span class="p">,</span> <span class="n">but</span> <span class="n">tests</span> <span class="n">want</span> <span class="n">it</span><span class="p">)</span>
    <span class="n">DRegister</span><span class="p">(</span><span class="k">in</span><span class="o">=</span><span class="n">ALUout</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="n">writeD</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">registerD</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">the</span> <span class="n">mux</span> <span class="k">on</span> <span class="n">the</span> <span class="n">right</span> <span class="k">of</span> <span class="n">diagam</span> <span class="mi">5</span><span class="o">.</span><span class="mi">9</span>
    <span class="n">Mux16</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">Aout</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">inM</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">cType</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">inputALU</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">alu</span>
    <span class="n">ALU</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">registerD</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">inputALU</span><span class="p">,</span> <span class="n">zx</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">11</span><span class="err">]</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">10</span><span class="err">]</span><span class="p">,</span> <span class="n">zy</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">9</span><span class="err">]</span><span class="p">,</span>
        <span class="n">ny</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">8</span><span class="err">]</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">7</span><span class="err">]</span><span class="p">,</span> <span class="n">no</span><span class="o">=</span><span class="n">instruction</span><span class="err">[</span><span class="mi">6</span><span class="err">]</span><span class="p">,</span> <span class="n">zr</span><span class="o">=</span><span class="n">zr</span><span class="p">,</span> <span class="n">ng</span><span class="o">=</span><span class="n">ng</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">ALUout</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">needed</span> <span class="k">for</span> <span class="n">feeding</span> <span class="n">back</span> <span class="n">as</span> <span class="n">outputs</span> <span class="k">of</span> <span class="n">the</span> <span class="n">CPU</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">fed</span> <span class="n">back</span>
    <span class="n">Or16</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">ALUout</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">outM</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">program</span> <span class="n">counter</span>
    <span class="n">PC</span><span class="p">(</span><span class="k">in</span><span class="o">=</span><span class="n">Aout</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="n">doJump</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="nb">true</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="n">reset</span><span class="p">,</span> <span class="k">out</span><span class="err">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">14</span><span class="err">]</span><span class="o">=</span><span class="n">pc</span><span class="p">);</span>
<span class="err">}</span>
</code></pre></div></div>

<p>Das RAM mit dem inkludierten Bildschirm und der Tastatur:</p>

<div class="language-vhdl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CHIP</span> <span class="n">Memory</span> <span class="err">{</span>
    <span class="k">IN</span> <span class="k">in</span><span class="err">[</span><span class="mi">16</span><span class="err">]</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="n">address</span><span class="err">[</span><span class="mi">15</span><span class="err">]</span><span class="p">;</span>
    <span class="k">OUT</span> <span class="k">out</span><span class="err">[</span><span class="mi">16</span><span class="err">]</span><span class="p">;</span>

    <span class="n">PARTS</span><span class="p">:</span>
    <span class="n">DMux4Way</span><span class="p">(</span><span class="k">in</span><span class="o">=</span><span class="n">load</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">address</span><span class="err">[</span><span class="mi">13</span><span class="o">..</span><span class="mi">14</span><span class="err">]</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">);</span>
    <span class="ow">Or</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">i</span><span class="p">);</span>
    <span class="n">RAM16K</span><span class="p">(</span><span class="k">in</span><span class="o">=</span><span class="k">in</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="err">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">13</span><span class="err">]</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">j</span><span class="p">);</span>
    <span class="n">Screen</span><span class="p">(</span><span class="k">in</span><span class="o">=</span><span class="k">in</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="err">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">12</span><span class="err">]</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="n">k</span><span class="p">);</span>
    <span class="n">Keyboard</span><span class="p">(</span><span class="k">out</span><span class="o">=</span><span class="n">l</span><span class="p">);</span>
    <span class="n">Mux4Way16</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">address</span><span class="err">[</span><span class="mi">13</span><span class="o">..</span><span class="mi">14</span><span class="err">]</span><span class="p">,</span> <span class="k">out</span><span class="o">=</span><span class="k">out</span><span class="p">);</span>
<span class="err">}</span>
</code></pre></div></div>
